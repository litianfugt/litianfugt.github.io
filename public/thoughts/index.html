<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>随想 | 李石原的博客</title>
<meta name="keywords" content="">
<meta name="description" content="这里记录一些日常的思考和感悟，技术的、生活的、或者任何突然想到的想法。欢迎点赞评论，一起交流！">
<meta name="author" content="李石原">
<link rel="canonical" href="http://localhost:1313/thoughts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6822ceb8a0b38479750ca7457a73646000945508c7e94006873a75f885e5453c.css" integrity="sha256-aCLOuKCzhHl1DKdFenNkYACUVQjH6UAGhzp1&#43;IXlRTw=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/thoughts/index.xml">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/thoughts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="stylesheet" href="http://localhost:1313/css/custom.css"><script src="/github-gist-config.js" defer></script><script src="/js/progress-bar.js" defer></script><meta property="og:url" content="http://localhost:1313/thoughts/">
  <meta property="og:site_name" content="李石原的博客">
  <meta property="og:title" content="随想">
  <meta property="og:description" content="这里记录一些日常的思考和感悟，技术的、生活的、或者任何突然想到的想法。欢迎点赞评论，一起交流！">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="随想">
<meta name="twitter:description" content="李石原的个人技术博客，专注于图像算法、计算机视觉和深度学习技术分享">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "随想",
      "item": "http://localhost:1313/thoughts/"
    }
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="首页 (Alt + H)">
                <img src="http://localhost:1313/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">首页</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/thoughts/" title="随想">
                    <span class="active">随想</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">
<main class="main">
    <div class="thoughts-container">
        <header class="thoughts-header">
            <div class="thoughts-header-content">
                <h1 class="thoughts-title">随想</h1>
                
                <div class="thoughts-description">
                    <p>这里记录一些日常的思考和感悟，技术的、生活的、或者任何突然想到的想法。欢迎点赞评论，一起交流！</p>

                </div>
                
            </div>
            <div class="thoughts-header-meta">
                <div class="thoughts-stats">
                    <span class="thoughts-count">2 条随想</span>
                    <span class="thoughts-separator">•</span>
                    <span class="thoughts-update">2025年9月24日 更新</span>
                </div>
            </div>
        </header>

        <div class="thoughts-list">
            
            <article class="thought-card" data-thought-id="2025-09-24-first-thought">
                <div class="thought-header">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=LiShiyuan" alt="李石原" class="thought-avatar">
                    <div class="thought-meta">
                        <div class="thought-author">李石原</div>
                        <div class="thought-time">2025-09-24 10:30</div>
                    </div>
                </div>
                <div class="thought-content">
                    <p>今天对博客进行了一些优化，增加了这个&quot;随想&quot;页面，希望可以更方便地记录日常的想法和感悟。</p>
<p>技术方面，最近在思考如何更好地组织代码结构，提高可维护性。有时候简单的功能也会有复杂的实现，关键是要找到合适的抽象层次。</p>
<hr>
<p><em>发布于 2025年9月24日 上午10:30</em></p>

                </div>
                <div class="thought-actions">
                    <div class="thought-actions-left">
                        <button class="thought-action comment-btn" data-thought-id="2025-09-24-first-thought">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                            </svg>
                            <span class="comment-count">0</span>
                        </button>
                    </div>
                    <div class="thought-stats">
                        <span class="thought-views">👁 1 分钟阅读</span>
                    </div>
                </div>
                <div class="thought-comments-placeholder" id="comments-placeholder-2025-09-24-first-thought" data-thought-id="2025-09-24-first-thought">
                    
                </div>
            </article>
            
            <article class="thought-card" data-thought-id="2025-09-23-meditation">
                <div class="thought-header">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=LiShiyuan" alt="李石原" class="thought-avatar">
                    <div class="thought-meta">
                        <div class="thought-author">李石原</div>
                        <div class="thought-time">2025-09-23 15:45</div>
                    </div>
                </div>
                <div class="thought-content">
                    <p>生活方面，感觉时间过得很快，需要更好地平衡工作和生活。最近开始尝试每天冥想10分钟，希望能帮助自己保持专注和平静。</p>
<p>有时候停下来思考比一直忙碌更重要。🧘‍♂️</p>
<hr>
<p><em>发布于 2025年9月23日 下午3:45</em></p>

                </div>
                <div class="thought-actions">
                    <div class="thought-actions-left">
                        <button class="thought-action comment-btn" data-thought-id="2025-09-23-meditation">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                            </svg>
                            <span class="comment-count">0</span>
                        </button>
                    </div>
                    <div class="thought-stats">
                        <span class="thought-views">👁 1 分钟阅读</span>
                    </div>
                </div>
                <div class="thought-comments-placeholder" id="comments-placeholder-2025-09-23-meditation" data-thought-id="2025-09-23-meditation">
                    
                </div>
            </article>
            
        </div>

        
        
    </div>
</main>



<div class="giscus-container">
    
    <div class="giscus-loading">加载评论中...</div>
</div>

<style>
    .giscus-container {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid var(--border);
    }
    
    .giscus-loading {
        text-align: center;
        padding: 20px;
        color: var(--secondary);
        font-size: 14px;
    }
    
    .giscus-frame {
        border-radius: 8px;
        box-shadow: 0 2px 8px var(--shadow-light);
    }
    
     
    @media (prefers-color-scheme: dark) {
        .giscus-frame {
            filter: brightness(0.9);
        }
    }
    
     
    @media (max-width: 768px) {
        .giscus-container {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
        }
    }
</style><script>
    console.log('Comments.html: Starting to load CommentManager...');
    
    
    window.addEventListener('error', function(e) {
        if (e.message.includes('commentManager') || e.message.includes('CommentManager')) {
            console.error('Global error handler caught CommentManager error:', e);
        }
    });

    
    window.addEventListener('unhandledrejection', function(e) {
        if (e.reason && e.reason.message && e.reason.message.includes('commentManager')) {
            console.error('Unhandled promise rejection related to CommentManager:', e.reason);
        }
    });

    
    class CommentManager {
        constructor() {
            this.instances = new Map();
            this.activeInstance = null;
            this.initialized = true;
            console.log('CommentManager: Initialized successfully');
        }
        
        
        getInstance(thoughtId) {
            if (!this.instances.has(thoughtId)) {
                console.log('CommentManager: Creating new instance for thought:', thoughtId);
                this.instances.set(thoughtId, {
                    thoughtId: thoughtId,
                    containerId: `comments-${thoughtId}`,
                    container: null,
                    isActive: false,
                    isLoading: false,
                    
                    
                    createContainer: function() {
                        const placeholder = document.getElementById(`comments-placeholder-${this.thoughtId}`);
                        if (!placeholder) {
                            console.error('CommentInstance: Placeholder not found for thought:', this.thoughtId);
                            return;
                        }
                        
                        this.container = document.createElement('div');
                        this.container.id = this.containerId;
                        this.container.className = 'thought-comments';
                        this.container.style.display = 'block';
                        
                        this.container.innerHTML = `
                            <div class="giscus-container">
                                <div class="giscus-loading">加载评论中...</div>
                            </div>
                        `;
                        
                        placeholder.parentNode.replaceChild(this.container, placeholder);
                        console.log('CommentInstance: Created container for thought:', this.thoughtId);
                    },
                    
                    
                    loadGiscus: function() {
                        console.log('CommentInstance: loadGiscus called for thought:', this.thoughtId);
                        const giscusContainer = this.container.querySelector('.giscus-container');
                        if (!giscusContainer) {
                            console.error('CommentInstance: Giscus container not found for thought:', this.thoughtId);
                            return;
                        }
                        
                        
                        console.log('CommentInstance: Starting comprehensive Giscus cleanup for thought:', this.thoughtId);
                        
                        
                        const existingFrame = giscusContainer.querySelector('iframe.giscus-frame');
                        if (existingFrame) {
                            console.log('CommentInstance: Removing existing frame for thought:', this.thoughtId);
                            existingFrame.remove();
                        } else {
                            console.log('CommentInstance: No existing frame found for thought:', this.thoughtId);
                        }
                        
                        const existingScript = giscusContainer.querySelector('script[src="https://giscus.app/client.js"]');
                        if (existingScript) {
                            console.log('CommentInstance: Removing existing script for thought:', this.thoughtId);
                            existingScript.remove();
                        } else {
                            console.log('CommentInstance: No existing script found for thought:', this.thoughtId);
                        }
                        
                        
                        const allGiscusFrames = document.querySelectorAll('iframe.giscus-frame');
                        const allGiscusScripts = document.querySelectorAll('script[src="https://giscus.app/client.js"]');
                        console.log('CommentInstance: Global Giscus check before cleanup - Frames:', allGiscusFrames.length, 'Scripts:', allGiscusScripts.length);
                        
                        
                        allGiscusFrames.forEach(frame => {
                            if (frame.closest('.giscus-container') !== giscusContainer) {
                                console.log('CommentInstance: Removing external frame from container:', frame.closest('.thought-comments')?.id);
                                frame.remove();
                            }
                        });
                        
                        
                        allGiscusScripts.forEach(script => {
                            if (script.closest('.giscus-container') !== giscusContainer) {
                                console.log('CommentInstance: Removing external script from container:', script.closest('.thought-comments')?.id);
                                script.remove();
                            }
                        });
                        
                        
                        const giscusElements = giscusContainer.querySelectorAll('.giscus, .giscus-frame, [class*="giscus"]');
                        giscusElements.forEach(element => {
                            if (element.tagName !== 'SCRIPT' && element.tagName !== 'IFRAME') {
                                console.log('CommentInstance: Removing additional Giscus element:', element.className);
                                element.remove();
                            }
                        });
                        
                        
                        giscusContainer.innerHTML = '<div class="giscus-loading">加载评论中...</div>';
                        
                        console.log('CommentInstance: Giscus cleanup completed for thought:', this.thoughtId);
                        
                        
                        const loading = giscusContainer.querySelector('.giscus-loading');
                        if (loading) {
                            loading.style.display = 'block';
                            loading.textContent = '加载评论中...';
                            loading.style.color = '';
                        }
                        
                        
                        const thoughtCard = document.querySelector(`.thought-card[data-thought-id="${this.thoughtId}"]`);
                        let thoughtContent = '';
                        let thoughtTitle = `随想 ${this.thoughtId}`;
                        
                        if (thoughtCard) {
                            const contentElement = thoughtCard.querySelector('.thought-content');
                            if (contentElement) {
                                const contentText = contentElement.textContent.trim();
                                thoughtContent = contentText;
                                thoughtTitle = contentText.substring(0, 50) + (contentText.length > 50 ? '...' : '');
                            }
                        }
                        
                        
                        const script = document.createElement('script');
                        script.src = 'https://giscus.app/client.js';
                        
                        const pagePath = window.location.pathname;
                        const uniqueId = `${pagePath}#${this.thoughtId}`;
                        
                        script.setAttribute('data-repo', 'litianfugt\/litianfugt.github.io');
                        script.setAttribute('data-repo-id', 'R_kgDOPkZVNQ');
                        script.setAttribute('data-category', 'General');
                        script.setAttribute('data-category-id', 'DIC_kwDOPkZVNc4Cv3cN');
                        script.setAttribute('data-mapping', 'specific');
                        script.setAttribute('data-term', uniqueId);
                        script.setAttribute('data-title', thoughtTitle);
                        if (thoughtContent) {
                            script.setAttribute('data-description', thoughtContent);
                        }
                        script.setAttribute('data-strict', '0');
                        script.setAttribute('data-reactions-enabled', '1');
                        script.setAttribute('data-emit-metadata', '1');
                        script.setAttribute('data-input-position', 'bottom');
                        script.setAttribute('data-theme', 'preferred_color_scheme');
                        script.setAttribute('data-lang', 'zh-CN');
                        script.setAttribute('data-loading', 'lazy');
                        script.setAttribute('crossorigin', 'anonymous');
                        script.setAttribute('async', '');
                        
                        
                        script.addEventListener('load', () => {
                            console.log('CommentInstance: Giscus loaded for thought:', this.thoughtId);
                            const loading = giscusContainer.querySelector('.giscus-loading');
                            if (loading) {
                                loading.style.display = 'none';
                            }
                            
                            
                            setTimeout(() => {
                                updateCommentCountFromGiscus(this.thoughtId);
                            }, 1000); 
                        });
                        
                        script.addEventListener('error', () => {
                            console.error('CommentInstance: Giscus load error for thought:', this.thoughtId);
                            const loading = giscusContainer.querySelector('.giscus-loading');
                            if (loading) {
                                loading.textContent = '评论加载失败，请刷新页面重试';
                                loading.style.color = '#F44336';
                            }
                        });
                        
                        giscusContainer.appendChild(script);
                        console.log('CommentInstance: Loading Giscus for thought:', this.thoughtId);
                    },
                    
                    
                    show: function() {
                        if (this.container) {
                            this.container.style.display = 'block';
                            console.log('CommentInstance: Showing comments for thought:', this.thoughtId);
                        }
                    },
                    
                    
                    hide: function() {
                        if (this.container) {
                            this.container.style.display = 'none';
                            console.log('CommentInstance: Hiding comments for thought:', this.thoughtId);
                        }
                    },
                    
                    
                    load: async function() {
                        if (this.isActive) return;
                        
                        console.log('CommentInstance: Starting load process for thought:', this.thoughtId);
                        this.isLoading = true;
                        
                        try {
                            
                            this.createContainer();
                            
                            
                            await new Promise(resolve => setTimeout(resolve, 50));
                            
                            
                            this.loadGiscus();
                            
                            
                            this.isActive = true;
                            console.log('CommentInstance: Load process initiated for thought:', this.thoughtId);
                        } catch (error) {
                            console.error('CommentInstance: Error during load process for thought:', this.thoughtId, error);
                            
                            this.isActive = true;
                        } finally {
                            this.isLoading = false;
                        }
                    },
                    
                    
                    destroy: function() {
                        console.log('CommentInstance: Destroying instance for thought:', this.thoughtId);
                        
                        if (this.container && this.container.parentNode) {
                            const placeholder = document.createElement('div');
                            placeholder.id = `comments-placeholder-${this.thoughtId}`;
                            placeholder.className = 'thought-comments-placeholder';
                            placeholder.setAttribute('data-thought-id', this.thoughtId);
                            
                            this.container.parentNode.replaceChild(placeholder, this.container);
                            this.container = null;
                        }
                        
                        this.isActive = false;
                        this.isLoading = false;
                    }
                });
            }
            return this.instances.get(thoughtId);
        }
        
        
        async activateInstance(thoughtId) {
            console.log('CommentManager: Activating instance for thought:', thoughtId);
            console.log('CommentManager: Current active instance:', this.activeInstance ? this.activeInstance.thoughtId : 'none');
            console.log('CommentManager: Total instances count:', this.instances.size);
            console.log('CommentManager: All instance IDs:', Array.from(this.instances.keys()));
            
            
            this.setLoadingState(thoughtId, true);
            
            try {
                
                if (this.activeInstance && this.activeInstance.thoughtId !== thoughtId) {
                    console.log('CommentManager: Deactivating current instance for thought:', this.activeInstance.thoughtId);
                    console.log('CommentManager: Before deactivation - instance state:', {
                        isActive: this.activeInstance.isActive,
                        isLoading: this.activeInstance.isLoading,
                        hasContainer: !!this.activeInstance.container
                    });
                    
                    
                    await this.deactivateCurrentInstanceAsync();
                    
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    const allGiscusFrames = document.querySelectorAll('iframe.giscus-frame');
                    const allGiscusScripts = document.querySelectorAll('script[src="https://giscus.app/client.js"]');
                    console.log('CommentManager: Global Giscus check after deactivation - Frames:', allGiscusFrames.length, 'Scripts:', allGiscusScripts.length);
                    
                    if (allGiscusFrames.length > 0 || allGiscusScripts.length > 0) {
                        console.log('CommentManager: Cleaning up remaining global Giscus elements');
                        allGiscusFrames.forEach(frame => frame.remove());
                        allGiscusScripts.forEach(script => script.remove());
                    }
                }
                
                const instance = this.getInstance(thoughtId);
                console.log('CommentManager: Got instance for thought:', thoughtId, 'isActive:', instance.isActive);
                console.log('CommentManager: Instance container exists:', !!instance.container);
                this.activeInstance = instance;
                
                if (!instance.isActive) {
                    console.log('CommentManager: Loading new instance for thought:', thoughtId);
                    console.log('CommentManager: Before load - instance.isLoading:', instance.isLoading);
                    
                    
                    if (!instance.container) {
                        instance.createContainer();
                    }
                    
                    
                    await instance.loadGiscus();
                    
                    
                    instance.isActive = true;
                    instance.isLoading = false;
                    
                    console.log('CommentManager: After load - instance.isActive:', instance.isActive, 'instance.isLoading:', instance.isLoading);
                    console.log('CommentManager: Instance loaded for thought:', thoughtId);
                } else {
                    console.log('CommentManager: Instance already active for thought:', thoughtId);
                }
                
                instance.show();
                console.log('CommentManager: Instance activated for thought:', thoughtId);
                console.log('CommentManager: Final state - activeInstance.thoughtId:', this.activeInstance.thoughtId);
                
                
                this.updateButtonState(thoughtId, true);
                
            } catch (error) {
                console.error('CommentManager: Error activating instance for thought:', thoughtId, error);
                
                
                this.updateButtonState(thoughtId, false);
                
                
                this.showNotification('评论加载失败，请刷新页面重试', 'error');
            } finally {
                
                this.setLoadingState(thoughtId, false);
            }
        }
        
        
        async deactivateCurrentInstanceAsync() {
            if (this.activeInstance) {
                console.log('CommentManager: Asynchronously deactivating current instance for thought:', this.activeInstance.thoughtId);
                console.log('CommentManager: Before deactivation - instance state:', {
                    isActive: this.activeInstance.isActive,
                    isLoading: this.activeInstance.isLoading,
                    hasContainer: !!this.activeInstance.container
                });
                
                
                this.activeInstance.hide();
                
                
                this.updateButtonState(this.activeInstance.thoughtId, false);
                
                
                if (this.activeInstance.container) {
                    const giscusContainer = this.activeInstance.container.querySelector('.giscus-container');
                    if (giscusContainer) {
                        console.log('CommentManager: Force cleaning Giscus container for thought:', this.activeInstance.thoughtId);
                        
                        
                        const frames = giscusContainer.querySelectorAll('iframe.giscus-frame');
                        const scripts = giscusContainer.querySelectorAll('script[src="https://giscus.app/client.js"]');
                        
                        frames.forEach(frame => {
                            console.log('CommentManager: Removing frame during deactivation');
                            frame.remove();
                        });
                        
                        scripts.forEach(script => {
                            console.log('CommentManager: Removing script during deactivation');
                            script.remove();
                        });
                        
                        
                        giscusContainer.innerHTML = '<div class="giscus-loading">加载评论中...</div>';
                    }
                }
                
                
                this.activeInstance.isActive = false;
                this.activeInstance.isLoading = false;
                
                
                this.activeInstance = null;
                
                console.log('CommentManager: Asynchronous deactivation completed');
                
                
                return Promise.resolve();
            } else {
                console.log('CommentManager: No active instance to deactivate');
                return Promise.resolve();
            }
        }
        
        
        setLoadingState(thoughtId, isLoading) {
            const button = document.querySelector(`.thought-action.comment-btn[data-thought-id="${thoughtId}"]`);
            if (button) {
                if (isLoading) {
                    button.classList.add('loading');
                    
                } else {
                    button.classList.remove('loading');
                }
            }
        }
        
        
        updateButtonState(thoughtId, isActive) {
            const button = document.querySelector(`.thought-action.comment-btn[data-thought-id="${thoughtId}"]`);
            if (button) {
                if (isActive) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            }
        }
        
        
        showNotification(message, type = 'info') {
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 14px 22px;
                border-radius: 8px;
                color: white;
                font-size: 14px;
                z-index: 1000;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                max-width: 320px;
                word-wrap: break-word;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                font-weight: 500;
            `;
            
            
            const colors = {
                success: '#4CAF50',
                warning: '#FF9800',
                error: '#F44336',
                info: '#2196F3'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            
            
            document.body.appendChild(notification);
            
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            
            const hideDelay = type === 'error' ? 5000 : 3000;
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, hideDelay);
        }
        
        
        deactivateCurrentInstance() {
            if (this.activeInstance) {
                console.log('CommentManager: Deactivating current instance for thought:', this.activeInstance.thoughtId);
                console.log('CommentManager: Before deactivation - instance state:', {
                    isActive: this.activeInstance.isActive,
                    isLoading: this.activeInstance.isLoading,
                    hasContainer: !!this.activeInstance.container
                });
                
                
                this.activeInstance.hide();
                
                
                if (this.activeInstance.container) {
                    const giscusContainer = this.activeInstance.container.querySelector('.giscus-container');
                    if (giscusContainer) {
                        console.log('CommentManager: Force cleaning Giscus container for thought:', this.activeInstance.thoughtId);
                        
                        
                        const frames = giscusContainer.querySelectorAll('iframe.giscus-frame');
                        const scripts = giscusContainer.querySelectorAll('script[src="https://giscus.app/client.js"]');
                        
                        frames.forEach(frame => {
                            console.log('CommentManager: Removing frame during deactivation');
                            frame.remove();
                        });
                        
                        scripts.forEach(script => {
                            console.log('CommentManager: Removing script during deactivation');
                            script.remove();
                        });
                        
                        
                        giscusContainer.innerHTML = '<div class="giscus-loading">加载评论中...</div>';
                    }
                }
                
                
                this.activeInstance.isActive = false;
                this.activeInstance.isLoading = false;
                
                
                this.activeInstance = null;
                
                console.log('CommentManager: Deactivation completed');
            } else {
                console.log('CommentManager: No active instance to deactivate');
            }
        }
        
        
        destroyInstance(thoughtId) {
            console.log('CommentManager: Destroying instance for thought:', thoughtId);
            
            const instance = this.instances.get(thoughtId);
            if (instance) {
                
                if (this.activeInstance && this.activeInstance.thoughtId === thoughtId) {
                    this.deactivateCurrentInstance();
                }
                
                
                instance.destroy();
                
                
                this.instances.delete(thoughtId);
                
                console.log('CommentManager: Instance destroyed and removed from map');
            } else {
                console.log('CommentManager: Instance not found for destruction:', thoughtId);
            }
        }
    }

    
    async function updateCommentCountFromGiscus(thoughtId) {
        console.log('Comments.html: Updating comment count from Giscus for thought:', thoughtId);
        
        try {
            
            const pagePath = window.location.pathname;
            const uniqueId = `${pagePath}#${thoughtId}`;
            
            
            const repo = 'litianfugt\/litianfugt.github.io';
            const categoryId = 'DIC_kwDOPkZVNc4Cv3cN';
            
            if (!repo || !categoryId) {
                console.warn('Comments.html: Giscus configuration not found');
                return;
            }
            
            
            const query = `
                query {
                    repository(owner: "${repo.split('/')[0]}", name: "${repo.split('/')[1]}") {
                        discussions(categoryId: "${categoryId}", first: 100) {
                            nodes {
                                title
                                comments {
                                    totalCount
                                }
                            }
                        }
                    }
                }
            `;
            
            
            const response = await fetch('https://api.github.com/graphql', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'bearer '
                },
                body: JSON.stringify({ query })
            });
            
            if (!response.ok) {
                throw new Error(`GitHub API request failed: ${response.status}`);
            }
            
            const data = await response.json();
            const discussions = data.data.repository.discussions.nodes;
            
            
            const discussion = discussions.find(d => d.title === uniqueId || d.title.includes(thoughtId));
            
            if (discussion) {
                const count = discussion.comments.totalCount;
                
                const commentButtons = document.querySelectorAll(`.thought-action.comment-btn[data-thought-id="${thoughtId}"]`);
                commentButtons.forEach(button => {
                    const countSpan = button.querySelector('.comment-count');
                    if (countSpan) {
                        countSpan.textContent = count;
                        
                        localStorage.setItem(`comment-count-${thoughtId}`, count);
                        console.log('Comments.html: Updated comment count for', thoughtId, 'to', count);
                    }
                });
            } else {
                console.log('Comments.html: No discussion found for thought:', thoughtId);
                
                const commentButtons = document.querySelectorAll(`.thought-action.comment-btn[data-thought-id="${thoughtId}"]`);
                commentButtons.forEach(button => {
                    const countSpan = button.querySelector('.comment-count');
                    if (countSpan) {
                        countSpan.textContent = '0';
                        
                        localStorage.setItem(`comment-count-${thoughtId}`, '0');
                    }
                });
            }
        } catch (error) {
            console.error('Comments.html: Error updating comment count from GitHub API:', error);
        }
    }
    
    
    window.CommentManager = CommentManager;
    window.commentManager = new CommentManager();
    
    console.log('Giscus: Comment system initialized successfully');
    console.log('Comments.html: CommentManager instance created and attached to window object');
    
    
    window.commentManagerLoaded = true;
</script>


<script src="/js/thoughts.js"></script>


<script>
    console.log('Thoughts list: Checking if CommentManager is available...');
    console.log('Thoughts list: window.commentManager type:', typeof window.commentManager);
    console.log('Thoughts list: window.CommentManager type:', typeof window.CommentManager);
    console.log('Thoughts list: window.commentManagerLoaded:', typeof window.commentManagerLoaded);
    
    
    if (typeof window.commentManager === 'undefined' && typeof window.CommentManager !== 'undefined') {
        console.log('Thoughts list: CommentManager class is available but instance is not, creating instance...');
        window.commentManager = new window.CommentManager();
    }
    
    
    setTimeout(() => {
        console.log('Thoughts list: Delayed check - CommentManager availability:', {
            commentManager: typeof window.commentManager,
            CommentManager: typeof window.CommentManager,
            commentManagerLoaded: typeof window.commentManagerLoaded
        });
        
        
        const commentButtons = document.querySelectorAll('.thought-action.comment-btn');
        console.log('Thoughts list: Found', commentButtons.length, 'comment buttons');
        
        if (commentButtons.length > 0) {
            console.log('Thoughts list: First comment button data:', {
                thoughtId: commentButtons[0].dataset.thoughtId,
                hasClickListener: commentButtons[0].onclick !== null || commentButtons[0].addEventListener
            });
        }
    }, 1000);
</script>

    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">李石原的博客</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
