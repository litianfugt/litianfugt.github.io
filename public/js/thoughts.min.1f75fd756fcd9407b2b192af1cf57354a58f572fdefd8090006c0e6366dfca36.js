document.addEventListener("DOMContentLoaded",function(){console.log("Thoughts.js: DOM loaded, initializing functionality...");const e={getLikes:function(){const e=localStorage.getItem("thoughts-likes");return e?JSON.parse(e):{}},setLikes:function(e){localStorage.setItem("thoughts-likes",JSON.stringify(e))},getComments:function(e){const t=localStorage.getItem(`thoughts-comments-${e}`);return t?JSON.parse(t):[]},setComments:function(e,t){localStorage.setItem(`thoughts-comments-${e}`,JSON.stringify(t))}};function m(){try{const t=e.getLikes(),n=document.querySelectorAll(".like-btn");if(n.length===0){console.warn("Thoughts.js: No like buttons found");return}n.forEach(e=>{const n=e.dataset.thoughtId,s=e.querySelector(".like-count");if(!n){console.warn("Thoughts.js: Like button missing data-thought-id");return}if(!s){console.warn("Thoughts.js: Like button missing like-count element");return}if(t[n]!==0[0]){const o=JSON.parse(localStorage.getItem("thoughts-user-likes")||"{}");o[n]&&e.classList.add("liked"),s.textContent=t[n]}else{const e=Math.floor(Math.random()*10)+1;t[n]=e,s.textContent=e}}),e.setLikes(t)}catch(e){console.error("Thoughts.js: Error initializing likes:",e)}}function d(){const n=document.querySelectorAll(".like-btn");n.forEach(n=>{n.addEventListener("click",function(){const n=this.dataset.thoughtId,i=this.querySelector(".like-count"),s=e.getLikes(),o=JSON.parse(localStorage.getItem("thoughts-user-likes")||"{}");this.classList.contains("liked")?(this.classList.remove("liked"),s[n]=Math.max(0,s[n]-1),o[n]=!1,i.textContent=s[n]):(this.classList.add("liked"),s[n]=(s[n]||0)+1,o[n]=!0,i.textContent=s[n]),e.setLikes(s),localStorage.setItem("thoughts-user-likes",JSON.stringify(o)),this.style.transform="scale(1.2)",setTimeout(()=>{this.style.transform="scale(1)"},150),t(this.classList.contains("liked")?"已点赞！":"已取消点赞","success")})})}function i(){try{const e=document.querySelectorAll(".comment-btn");if(e.length===0){console.warn("Thoughts.js: No comment buttons found");return}e.forEach(e=>{const t=e.dataset.thoughtId;if(!t){console.warn("Thoughts.js: Comment button missing data-thought-id");return}e.addEventListener("click",function(){const e=document.getElementById(`comments-${t}`);if(!e){console.error("Thoughts.js: Comments section not found for thought:",t);return}e.style.display==="none"||e.style.display===""?(e.style.display="block",this.classList.add("active"),l(t),n(t),setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"nearest"})},100)):(e.style.display="none",this.classList.remove("active"))})})}catch(e){console.error("Thoughts.js: Error initializing comment buttons:",e)}}function l(e){const t=document.getElementById(`comments-${e}`);if(!t.querySelector(".thought-comments-list")){const e=document.createElement("div");e.className="thought-comments-list",e.style.marginBottom="15px",t.insertBefore(e,t.querySelector(".thought-comment-form"))}}function n(t){const s=e.getComments(t),n=document.querySelector(`#comments-${t} .thought-comments-list`);if(!n)return;if(n.innerHTML="",s.length===0){const e=document.createElement("div");e.className="no-comments",e.textContent="暂无评论，来做第一个评论的人吧！",e.style.textAlign="center",e.style.color="var(--secondary)",e.style.padding="20px",e.style.fontSize="14px",n.appendChild(e)}else s.forEach(e=>{const t=a(e);n.appendChild(t)})}function a(e){const n=document.createElement("div");n.className="thought-comment";const s=document.createElement("img");s.className="comment-avatar",s.src=`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.author||"visitor"}`,s.alt=e.author||"访客";const t=document.createElement("div");t.className="comment-content";const o=document.createElement("div");o.className="comment-author",o.textContent=e.author||"匿名用户";const i=document.createElement("div");i.className="comment-text",i.textContent=e.text;const a=document.createElement("div");return a.className="comment-time",a.textContent=r(e.timestamp),t.appendChild(o),t.appendChild(i),t.appendChild(a),n.appendChild(s),n.appendChild(t),n}function r(e){const a=new Date,s=new Date(e),t=a-s,n=Math.floor(t/6e4),o=Math.floor(t/36e5),i=Math.floor(t/864e5);return n<1?"刚刚":n<60?`${n}分钟前`:o<24?`${o}小时前`:i<7?`${i}天前`:s.toLocaleDateString("zh-CN")}function c(){const s=document.querySelectorAll(".comment-submit");s.forEach(s=>{s.addEventListener("click",function(){const s=this.dataset.thoughtId,i=document.querySelector(`#comments-${s} .comment-input`),a=i.value.trim();if(!a){t("请输入评论内容","warning"),i.focus();return}if(a.length>200){t("评论内容不能超过200字","warning"),i.focus();return}const r=this.textContent;this.disabled=!0,this.textContent="发送中...";try{const c={text:a,author:"访客",timestamp:(new Date).toISOString(),id:Date.now().toString()},r=e.getComments(s);r.unshift(c),e.setComments(s,r),i.value="",n(s),o(s),t("评论发表成功！","success"),setTimeout(()=>{const e=document.querySelector(`#comments-${s} .thought-comment:first-child`);e&&(e.scrollIntoView({behavior:"smooth",block:"nearest"}),e.style.backgroundColor="rgba(76, 175, 80, 0.1)",setTimeout(()=>{e.style.backgroundColor=""},2e3))},100)}catch(e){console.error("Thoughts.js: Error submitting comment:",e),t("评论发表失败，请重试","error")}finally{this.disabled=!1,this.textContent=r}})})}function o(t){const n=e.getComments(t),s=document.querySelector(`.comment-btn[data-thought-id="${t}"]`),o=s.querySelector(".comment-count");o.textContent=n.length}function t(e,t="info"){const i=document.querySelectorAll(".notification");i.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e,n.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 14px 22px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 320px;
            word-wrap: break-word;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-weight: 500;
        `;const s={success:"#4CAF50",warning:"#FF9800",error:"#F44336",info:"#2196F3"},o={success:"✓",warning:"⚠",error:"✗",info:"ℹ"};n.style.backgroundColor=s[t]||s.info,n.innerHTML=`${o[t]||o.info} ${e}`,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="1",n.style.transform="translateX(0)"},10);const a=t==="error"?5e3:3e3;setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(100%)",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},a)}function u(){const e=document.querySelectorAll(".comment-btn");e.forEach(e=>{const t=e.dataset.thoughtId;o(t)})}function h(){const e=document.querySelectorAll(".comment-input");e.forEach(e=>{e.addEventListener("keypress",function(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();const t=this.closest(".thought-comments").id.replace("comments-",""),n=document.querySelector(`.comment-submit[data-thought-id="${t}"]`);n.click()}}),window.innerWidth<=768&&e.addEventListener("input",function(){this.style.height="auto",this.style.height=Math.min(this.scrollHeight,100)+"px"})})}function s(){const e=window.innerWidth<=768;if(e){const e=document.querySelectorAll(".like-btn, .comment-btn, .comment-submit");e.forEach(e=>{e.addEventListener("touchstart",function(){this.style.transform="scale(0.95)"}),e.addEventListener("touchend",function(){this.style.transform="scale(1)"})});const t=document.querySelectorAll(".comment-btn");t.forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.thoughtId,e=document.getElementById(`comments-${t}`);e&&e.style.display==="block"&&setTimeout(()=>{const t=e.querySelector(".comment-input");t&&t.scrollIntoView({behavior:"smooth",block:"center"})},300)})})}}function f(){console.log("Thoughts.js: Starting initialization...");try{m(),console.log("Thoughts.js: Likes initialized"),d(),console.log("Thoughts.js: Like buttons initialized"),i(),console.log("Thoughts.js: Comment buttons initialized"),c(),console.log("Thoughts.js: Comment submission initialized"),u(),console.log("Thoughts.js: Comment counts initialized"),h(),console.log("Thoughts.js: Comment input handlers initialized"),s(),console.log("Thoughts.js: Mobile optimization initialized"),console.log("Thoughts.js: All functionality initialized successfully!")}catch(e){console.error("Thoughts.js: Error during initialization:",e)}}window.addEventListener("resize",function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{s()},250)}),f()})